<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
</head>
<body>
<py-script>
    # This function is used in the Lz77 algorithm.
    def repeating_length_from_start(window, input_string):
        """Get the maximum repeating length of the input from the start of the window"""

        if window == "" or input_string == "":
            return 0
        elif window[0] == input_string[0]:
            return 1 + repeating_length_from_start(window[1:] + input_string[0], input_string[1:])
        else:
            return 0

    # This function is used in the Lz77 algorithm.
    def best_length_offset(window, input_string, max_length=15, max_offset=4095):
        """Return the offset and length with the biggest length of the input string as a substring"""

        if max_offset < len(window):
            cut_window = window[-max_offset:]
        else:
            cut_window = window

        # return (0, 0) if the string provided is empty
        if input_string is None or input_string == "":
            return 0, 0

        # initialize result parameters with best case so far
        length, offset = (1, 0)

        # catch the empty window case
        if input_string[0] not in cut_window:
            best_length = repeating_length_from_start(input_string[0], input_string[1:])
            return min((length + best_length), max_length), offset

        # the best length now zero to allow occurrences to take priority
        length = 0

        # look for either the whole window or up to max offset away, whichever is smaller
        for index in range(1, (len(cut_window) + 1)):
            # get the character at this offset
            char = cut_window[-index]
            if char == input_string[0]:
                found_offset = index
                # collect any further strings which can be found
                found_length = repeating_length_from_start(cut_window[-index:], input_string)
                if found_length > length:
                    length = found_length
                    offset = found_offset

        # only return up to the maximum length
        return min(length, max_length), offset


    # This function is used in the Lz78 algorithm.
    def longest_common_substring(s1, s2):
        # go along the first string and search for the longest match
        maxLongest = 0
        offset = 0
        for i in range(0, len(s1)):
            longest = 0
            if ((i == len(s1) - len(s2) - 2)):
                break
            for j in range(0, len(s2)):
                if (i+j < len(s1)):
                    if s1[i+j] == s2[j]:
                        longest = longest + 1
                        if (maxLongest < longest):
                            maxLongest = longest
                            offset = i
                    else:
                        break
                else:
                    break
        return maxLongest, offset


    def compress_lz77(input_string, max_offset=2047, max_length=31):
        """Compress the input string into a list of length, offset, char values"""

        # create the input
        input_array = str(input_string[:])

        # create a string of the characters which have been passed
        window = ""

        # store output in this list
        output = []

        while input_array != "":
            length, offset = best_length_offset(window, input_array, max_length, max_offset)
            output.append((offset, length, input_array[0]))
            window += input_array[:length]
            input_array = input_array[length:]

        return output

    def decompress_lz77(compressed):
        """Turn the list of (offset, length, char) into an output string"""

        output = ""

        for value in compressed:
            offset, length, char = value

            if length == 0:
                if char is not None:
                    output += char
            else:
                if offset == 0:
                    if char is not None:
                        output += char
                        length -= 1
                        offset = 1
                start_index = len(output) - offset
                for i in range(length):
                    output += output[start_index + i]

        return output


    def compress_lz78(text):
        dictionary = dict()
        i = 0
        index = 1
        encodedNumbers = []
        encodedLetters = []
        while i < len(text):
            stringToBeSaved = text[i]
            indexInDictionary = 0
            while stringToBeSaved in dictionary:
                indexInDictionary = dictionary[stringToBeSaved]
                if (i == len(text) - 1):
                    stringToBeSaved = " "
                    break
                i = i + 1
                stringToBeSaved = stringToBeSaved + text[i]
            #print ("<{0}, {1}>".format(indexInDictionary, stringToBeSaved[len(stringToBeSaved) - 1]))
            encodedNumbers.append(indexInDictionary)
            encodedLetters.append(stringToBeSaved[len(stringToBeSaved) - 1])
            if (stringToBeSaved not in dictionary):
                dictionary[stringToBeSaved] = index
                index = index + 1
            i = i + 1

        return encodedNumbers, encodedLetters, dictionary

    def decompress_lz78(encodedNumbers, encodedLetters, dictionary):
        decoded = ""
        i = 0
        while i < len(encodedNumbers):
            if (encodedNumbers[i] != 0):
                decoded += str(list(dictionary.keys())[list(dictionary.values()).index(encodedNumbers[i])])
            decoded+=(encodedLetters[i])
            i = i+1
        return decoded

    # Initialize global variable for lz77 algorithm
    index_compress_lz77 = 0
    index_decompress_lz77 = 0
    data_original_lz77 = "tipp tap tipp tap tippe tippe tipp tap"
    data_compressed_lz77 = compress_lz77(data_original_lz77)
    data_decompressed_lz77 = decompress_lz77(data_compressed_lz77)

    # Initialize global variable for lz78 algorithm
    index_compress_lz78 = 0
    index_decompress_lz78 = 0
    data_original_lz78 = "tipp tap tipp tap tippe tippe tipp tap"
    data_compressed_lz78=[]
    [encodedNumbers, encodedLetters, dictionary]=compress_lz78(data_original_lz78)
    for i in range(len(encodedNumbers)):
        data_compressed_lz78.append([encodedNumbers[i], encodedLetters[i]])
    data_decompressed_lz78 = decompress_lz78(encodedNumbers, encodedLetters, dictionary)


    def get_compress_input_lz77(*args, **kwargs):
        global index_compress_lz77, data_original_lz77, data_compressed_lz77
        data_original_lz77 = Element("data_original_input_lz77").element.value
        data_compressed_lz77 = compress_lz77(data_original_lz77)
        index_compress_lz77 = 0
        pyscript.write("data_compressed_lz77", data_compressed_lz77[:index_compress_lz77])

    def button_compress_previous_lz77(condition):
        global index_compress_lz77
        index_compress_lz77 -= 1
        index_compress_lz77 = index_compress_lz77 % len(data_compressed_lz77)
        pyscript.write("data_compressed_lz77", data_compressed_lz77[:index_compress_lz77+1])

    def button_compress_next_lz77(condition):
        global index_compress_lz77
        index_compress_lz77 += 1
        index_compress_lz77 = index_compress_lz77 % len(data_compressed_lz77)
        pyscript.write("data_compressed_lz77", data_compressed_lz77[:index_compress_lz77+1])

    def get_compress_input_lz78(*args, **kwargs):
        global index_compress_lz78, data_original_lz78, data_compressed_lz78,encodedNumbers,encodedLetters, dictionary
        data_original_lz78 = Element("data_original_input_lz78").element.value
        data_compressed_lz78=[]
        [encodedNumbers, encodedLetters, dictionary]=compress_lz78(data_original_lz78)
        for i in range(len(encodedNumbers)):
            data_compressed_lz78.append([encodedNumbers[i], encodedLetters[i]])
        index_compress_lz78 = 0
        pyscript.write("data_compressed_lz78", data_compressed_lz78[:index_compress_lz78])

    def button_compress_previous_lz78(condition):
        global index_compress_lz78,encodedNumbers
        index_compress_lz78 -= 1
        index_compress_lz78 = index_compress_lz78 % len(encodedNumbers)
        pyscript.write("data_compressed_lz78", data_compressed_lz78[:index_compress_lz78+1])

    def button_compress_next_lz78(condition):
        global index_compress_lz78
        index_compress_lz78 += 1
        index_compress_lz78 = index_compress_lz78 % len(data_compressed_lz78)
        pyscript.write("data_compressed_lz78", data_compressed_lz78[:index_compress_lz78+1])


    # Functions for the Lz77 decompress
    def get_decompress_input_lz77(*args, **kwargs):
        global index_decompress_lz77, data_compressed_lz77, data_decompressed_lz77
        data_compressed_lz77 = eval(Element("data_compressed_input_lz77").element.value)
        index_decompress_lz77 = -1
        data_decompressed_lz77 = " "
        pyscript.write("data_decompressed_lz77", " ")
        print(index_decompress_lz77)

    def button_decompress_previous_lz77(condition):
        global index_decompress_lz77, data_decompressed_lz77
        index_decompress_lz77 -= 1
        index_decompress_lz77 = index_decompress_lz77 % len(data_compressed_lz77)
        data_decompressed_lz77 = decompress_lz77(data_compressed_lz77[:index_decompress_lz77 + 1])
        pyscript.write("data_decompressed_lz77", data_decompressed_lz77)

    def button_decompress_next_lz77(condition):
        global index_decompress_lz77, data_decompressed_lz77
        index_decompress_lz77 += 1
        index_decompress_lz77 = index_decompress_lz77 % len(data_compressed_lz77)
        data_decompressed_lz77 = decompress_lz77(data_compressed_lz77[:index_decompress_lz77 + 1])
        pyscript.write("data_decompressed_lz77", data_decompressed_lz77)

     # Functions for the Lz78 decompress
    def get_decompress_input_lz78(*args, **kwargs):
        global index_decompress_lz78, data_compressed_lz78, data_decompressed_lz78
        data_compressed_lz78 = eval(Element("data_compressed_input_lz78").element.value)
        index_decompress_lz78 = -1
        data_decompressed_lz78 = " "
        pyscript.write("data_decompressed_lz78", " ")
        print(index_decompress_lz78)

    def button_decompress_previous_lz78(condition):
        global index_decompress_lz78, data_decompressed_lz78,encodedNumbers, encodedLetters, dictionary
        index_decompress_lz78 -= 1
        index_decompress_lz78 = index_decompress_lz78 % len(encodedNumbers)
        print(len(encodedNumbers))
        data_decompressed_x = decompress_lz78(encodedNumbers, encodedLetters, dictionary)
        data_decompressed_lz78 = data_decompressed_x[:index_decompress_lz78 + 1]
        pyscript.write("data_decompressed_lz78", data_decompressed_lz78)

    def button_decompress_next_lz78(condition):
        global index_decompress_lz78, data_decompressed_lz78,encodedNumbers, encodedLetters, dictionary
        index_decompress_lz78 += 1
        index_decompress_lz78 = index_decompress_lz78 % len(encodedNumbers)
        data_decompressed_x = decompress_lz78(encodedNumbers, encodedLetters, dictionary)
        data_decompressed_lz78 = data_decompressed_x[:index_decompress_lz78 + 1]
        pyscript.write("data_decompressed_lz78", data_decompressed_lz78)

    Element("data_original_input_lz77").element.value = data_original_lz77
    Element("data_compressed_input_lz77").element.value = [(0, 1, 't'), (0, 1, 'i'), (0, 2, 'p'), (0, 1, ' '), (5, 1, 't'), (0, 1, 'a'), (4, 3, 'p'), (9, 12, 'i'), (0, 1, 'e'), (6, 11, ' '), (21, 4, ' ')]
    Element("data_original_input_lz78").element.value = data_original_lz78
    Element("data_compressed_input_lz78").element.value = [[0, 't'], [0, 'i'], [0, 'p'], [3, ' '], [1, 'a'], [4, 't'], [2, 'p'], [6, 'a'], [6, 'i'], [3, 'p'], [0, 'e'], [0, ' '], [1, 'i'], [10, 'e'], [12, 't'], [7, 'p'], [15, 'a'], [3, ' ']]
</py-script>

<div class="row">
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h3>LZ77 Compression Algorithm</h3>
            </div>
            <div class="card-body">
                <h5 class="card-title">Compress with LZ77 Compression Algorithm</h5>
                <p class="card-text">
                    <input type="text" id="data_original_input_lz77"
                           class="p-2 text-white bg-blue-600 border border-blue-600 rounded" style="width: 40vw;"/>
                    <button id="get_compress_input_lz77" class="p-2 text-white bg-blue-600 border border-blue-600 rounded"
                            type="submit"
                            pys-onClick="get_compress_input_lz77">
                        Enter
                    </button>
                <div id="data_compressed_lz77" class="alert alert-primary" style="width: 40vw;"></div>
                <button id="button_compress_previous_lz77" class="p-2 text-white bg-blue-600 border border-blue-600 rounded"
                        type="submit"
                        pys-onClick="button_compress_previous_lz77">
                    Previous
                </button>
                <button id="button_compress_next_lz77" class="p-2 text-white bg-blue-600 border border-blue-600 rounded"
                        type="submit"
                        pys-onClick="button_compress_next_lz77">
                    Next
                </button>
                </p>
                <h5 class="card-title">Decompress with LZ77 Compression Algorithm</h5>
                <p class="card-text">
                    <input type="text" id="data_compressed_input_lz77"
                           class="p-2 text-white bg-blue-600 border border-blue-600 rounded" style="width: 40vw;"/>
                    <button id="get_decompress_input_lz77" class="p-2 text-white bg-blue-600 border border-blue-600 rounded"
                            type="submit"
                            pys-onClick="get_decompress_input_lz77">
                        Enter
                    </button>
                <div id="data_decompressed_lz77" class="alert alert-primary" style="width: 40vw;"></div>
                <button id="button_decompress_previous_lz77"
                        class="p-2 text-white bg-blue-600 border border-blue-600 rounded" type="submit"
                        pys-onClick="button_decompress_previous_lz77">
                    Previous
                </button>
                <button id="button_decompress_next_lz77" class="p-2 text-white bg-blue-600 border border-blue-600 rounded"
                        type="submit"
                        pys-onClick="button_decompress_next_lz77">
                    Next
                </button>
                </p>
            </div>
        </div>
    </div>
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h3>LZ78 Compression Algorithm</h3>
            </div>
            <div class="card-body">
                <h5 class="card-title">Compress with LZ78 Compression Algorithm</h5>
                 <p class="card-text">
                    <input type="text" id="data_original_input_lz78"
                           class="p-2 text-white bg-blue-600 border border-blue-600 rounded" style="width: 40vw;"/>
                    <button id="get_compress_input_lz78" class="p-2 text-white bg-blue-600 border border-blue-600 rounded"
                            type="submit"
                            pys-onClick="get_compress_input_lz78">
                        Enter
                    </button>
                <div id="data_compressed_lz78" class="alert alert-primary" style="width: 40vw;"></div>
                <button id="button_compress_previous_lz78" class="p-2 text-white bg-blue-600 border border-blue-600 rounded"
                        type="submit"
                        pys-onClick="button_compress_previous_lz78">
                    Previous
                </button>
                <button id="button_compress_next_lz78" class="p-2 text-white bg-blue-600 border border-blue-600 rounded"
                        type="submit"
                        pys-onClick="button_compress_next_lz78">
                    Next
                </button>
                </p>
                <h5 class="card-title">Decompress with LZ78 Compression Algorithm</h5>
                <p class="card-text">
                    <input type="text" id="data_compressed_input_lz78"
                           class="p-2 text-white bg-blue-600 border border-blue-600 rounded" style="width: 40vw;"/>
                    <button id="get_decompress_input_lz78" class="p-2 text-white bg-blue-600 border border-blue-600 rounded"
                            type="submit"
                            pys-onClick="get_decompress_input_lz78">
                        Enter
                    </button>
                <div id="data_decompressed_lz78" class="alert alert-primary" style="width: 40vw;"></div>
                <button id="button_decompress_previous_lz78"
                        class="p-2 text-white bg-blue-600 border border-blue-600 rounded" type="submit"
                        pys-onClick="button_decompress_previous_lz78">
                    Previous
                </button>
                <button id="button_decompress_next_lz78" class="p-2 text-white bg-blue-600 border border-blue-600 rounded"
                        type="submit"
                        pys-onClick="button_decompress_next_lz78">
                    Next
                </button>
                </p>
            </div>
        </div>
    </div>
</div>
</body>
</html>
